import{j as x}from"./ui-Dwp8H4lk.js";import{a as u,f as A}from"./vendor-CNWCjkky.js";import{at as v,aj as Z,au as N,ak as $,al as L,am as I,c as j,av as q,D as V,t as m,u as B,j as z,f as M,aw as O,h as Q,l as W,aq as G,p as J,s as H}from"./index-debFNmPV.js";import"./animations-DgOVmwgG.js";const F=[{id:"re_1234567890",amount:125e3,currency:"USD",status:"succeeded",paymentId:"pi_1234567890",reason:"requested_by_customer",created:new Date("2024-01-15T11:30:00Z"),customer:{id:"cus_abc123",name:"John Doe",email:"john.doe@example.com"},paymentMethod:"Visa ••• 4242",description:"Refund for subscription cancellation",fee:0,net:-125e3,transactionId:"txn_refund_1234567890",lastUpdated:new Date("2024-01-15T11:35:00Z"),processingTime:2.1},{id:"re_0987654321",amount:75e4,currency:"USD",status:"pending",paymentId:"pi_0987654321",reason:"duplicate",created:new Date("2024-01-14T16:45:00Z"),customer:{id:"cus_def456",name:"Jane Smith",email:"jane.smith@example.com"},paymentMethod:"Mastercard ••• 5555",description:"Duplicate charge refund",fee:0,net:-75e4,transactionId:"txn_refund_0987654321",lastUpdated:new Date("2024-01-14T16:50:00Z"),processingTime:1.8},{id:"re_1122334455",amount:1500,currency:"USD",status:"failed",paymentId:"pi_1122334455",reason:"fraudulent",created:new Date("2024-01-13T10:15:00Z"),customer:{id:"cus_ghi789",name:"Bob Johnson",email:"bob.johnson@example.com"},paymentMethod:"Amex ••• 3782",description:"Fraudulent transaction refund attempt",fee:0,net:0,transactionId:"txn_refund_1122334455",lastUpdated:new Date("2024-01-13T10:20:00Z"),processingTime:.5},{id:"re_5566778899",amount:125e4,currency:"USD",status:"succeeded",paymentId:"pi_5566778899",reason:"requested_by_customer",created:new Date("2024-01-12T15:20:00Z"),customer:{id:"cus_jkl012",name:"Alice Wilson",email:"alice.wilson@example.com"},paymentMethod:"Visa ••• 1234",description:"Product return refund",fee:0,net:-125e4,transactionId:"txn_refund_5566778899",lastUpdated:new Date("2024-01-12T15:30:00Z"),processingTime:3.2},{id:"re_9988776655",amount:5e5,currency:"USD",status:"canceled",paymentId:"pi_9988776655",reason:"requested_by_customer",created:new Date("2024-01-11T12:00:00Z"),customer:{id:"cus_mno345",name:"Charlie Brown",email:"charlie.brown@example.com"},paymentMethod:"Apple Pay",description:"Canceled refund request",fee:0,net:0,transactionId:"txn_refund_9988776655",lastUpdated:new Date("2024-01-11T12:05:00Z"),processingTime:.3},{id:"re_partial_001",amount:15e4,currency:"USD",status:"succeeded",paymentId:"pi_partial_refund",reason:"requested_by_customer",created:new Date("2024-01-06T15:45:00Z"),customer:{id:"cus_partial123",name:"Partial Refund Customer",email:"partial@example.com"},paymentMethod:"Discover ••• 1234",description:"Partial refund for damaged product",fee:0,net:-15e4,transactionId:"txn_partial_refund_001",lastUpdated:new Date("2024-01-06T15:50:00Z"),processingTime:2.7},{id:"re_enterprise_001",amount:25e5,currency:"USD",status:"succeeded",paymentId:"pi_large_amount",reason:"requested_by_customer",created:new Date("2024-01-10T17:30:00Z"),customer:{id:"cus_xyz789",name:"Enterprise Client",email:"enterprise@bigcorp.com"},paymentMethod:"Wire Transfer",description:"Enterprise license refund",fee:0,net:-25e5,transactionId:"txn_refund_enterprise_001",lastUpdated:new Date("2024-01-10T17:45:00Z"),processingTime:5.8},{id:"re_international_001",amount:85e4,currency:"EUR",status:"succeeded",paymentId:"pi_international",reason:"requested_by_customer",created:new Date("2024-01-09T09:15:00Z"),customer:{id:"cus_int123",name:"Hans Mueller",email:"hans.mueller@example.de"},paymentMethod:"SEPA Direct Debit",description:"Annual subscription refund",fee:0,net:-85e4,transactionId:"txn_refund_international_001",lastUpdated:new Date("2024-01-09T09:20:00Z"),processingTime:4.1},{id:"re_mobile_001",amount:299900,currency:"USD",status:"pending",paymentId:"pi_mobile_payment",reason:"requested_by_customer",created:new Date("2024-01-03T13:15:00Z"),customer:{id:"cus_mobile123",name:"Mobile User",email:"mobile@example.com"},paymentMethod:"Apple Pay",description:"Mobile app subscription refund",fee:0,net:-299900,transactionId:"txn_refund_mobile_001",lastUpdated:new Date("2024-01-03T13:16:00Z"),processingTime:1.2},{id:"re_student_001",amount:999,currency:"USD",status:"succeeded",paymentId:"pi_student_discount",reason:"requested_by_customer",created:new Date("2023-12-30T15:22:00Z"),customer:{id:"cus_student345",name:"Student User",email:"student@university.edu"},paymentMethod:"Mastercard ••• 1111",description:"Student subscription refund",fee:0,net:-999,transactionId:"txn_refund_student_001",lastUpdated:new Date("2023-12-30T15:23:00Z"),processingTime:.8}];class K{applyFilters(c,e){let r=c;const n=e.statusFilter||e.status;if(n&&n!=="all"){const s=v.refund.mappings[n]||[n];r=r.filter(d=>s.includes(d.status))}if(e.filters?.status&&Array.isArray(e.filters.status)&&e.filters.status.length>0&&(r=r.filter(a=>e.filters.status.includes(a.status))),e.query?.trim()){const a=e.query.toLowerCase().trim();r=r.filter(s=>s.id.toLowerCase().includes(a)||s.paymentId.toLowerCase().includes(a)||s.customer.name.toLowerCase().includes(a)||s.customer.email.toLowerCase().includes(a)||s.description.toLowerCase().includes(a))}return r}calculateFacets(c){const e=c.reduce((n,a)=>{const s=a.status||"unknown";return n[s]=(n[s]||0)+1,n},{});return{status:Object.entries(e).map(([n,a])=>({value:n,count:a}))}}async getRefundsForNavigation(c,e={}){try{await new Promise(R=>setTimeout(R,300));let r=[...F];const n=this.calculateFacets(r),a=this.applyFilters(r,e),s=e.sortBy||"created",d=e.sortOrder||"desc";a.sort((R,C)=>{let h=R[s],i=C[s];if(s.includes("customer.")){const T=s.split(".")[1];h=R.customer[T],i=C.customer[T]}return h instanceof Date&&(h=h.getTime()),i instanceof Date&&(i=i.getTime()),typeof h=="string"&&(h=h.toLowerCase()),typeof i=="string"&&(i=i.toLowerCase()),h<i?d==="asc"?-1:1:h>i?d==="asc"?1:-1:0});const g=c-1,f=e.pageSize||20,w=a.length,p=Math.ceil(w/f),_=g*f,t=_+f;return{data:a.slice(_,t),total:w,totalPages:p,facets:n}}catch(r){throw console.error("Error in getRefundsForNavigation:",r),new Error("Failed to fetch refunds")}}async createRefund(c){try{return await new Promise(r=>setTimeout(r,1e3)),{refund:{id:`re_${Date.now()}`,paymentId:c.paymentId,amount:c.amount,currency:"USD",status:"pending",reason:c.reason||"requested_by_customer",created:new Date,lastUpdated:new Date,customer:{id:`cus_${Date.now()}`,name:"New Customer",email:"customer@example.com"},paymentMethod:"Credit Card ••••1234",description:"New refund request",fee:0,net:-c.amount,transactionId:`txn_refund_${Date.now()}`,processingTime:0},success:!0}}catch(e){throw console.error("Error creating refund:",e),new Error("Failed to create refund")}}async processRefund(c){try{await new Promise(n=>setTimeout(n,500));const e=F.find(n=>n.id===c);if(!e)throw new Error("Refund not found");return{success:!0,refund:{...e,status:"succeeded",lastUpdated:new Date}}}catch(e){throw console.error("Error processing refund:",e),new Error("Failed to process refund")}}async cancelRefund(c){try{await new Promise(n=>setTimeout(n,500));const e=F.find(n=>n.id===c);if(!e)throw new Error("Refund not found");return{success:!0,refund:{...e,status:"canceled",lastUpdated:new Date}}}catch(e){throw console.error("Error canceling refund:",e),new Error("Failed to cancel refund")}}async retryRefund(c){try{await new Promise(n=>setTimeout(n,1e3));const e=F.find(n=>n.id===c);if(!e)throw new Error("Refund not found");return{success:!0,refund:{...e,status:"pending",lastUpdated:new Date}}}catch(e){throw console.error("Error retrying refund:",e),new Error("Failed to retry refund")}}async exportRefunds(c){try{return await new Promise(r=>setTimeout(r,1500)),{success:!0,url:`/exports/refunds/${Date.now()}.csv`}}catch(e){throw console.error("Error exporting refunds:",e),new Error("Failed to export refunds")}}}const D=new K,k={amount:L("amount","Amount"),status:$("refund"),customer:{key:"customer",header:"Customer",width:200,render:o=>x.jsx(I,{maxWidth:200,className:"text-muted-foreground group-hover:text-foreground font-normal",title:o.customer?.name||o.customer?.email||"Unknown",children:o.customer?.name||o.customer?.email||"Unknown"})},reason:{key:"reason",header:"Reason",width:180,render:o=>x.jsx(I,{maxWidth:180,className:"text-muted-foreground group-hover:text-foreground font-normal capitalize",title:o.reason?.replace(/_/g," ")||"Unknown",children:o.reason?.replace(/_/g," ")||"Unknown"})},paymentMethod:N(),created:Z("created","Created",180)},E={all:["amount","status","customer","reason","paymentMethod","created"]},Y=(o="all")=>(E[o]||E.all).map(e=>k[e]).filter(Boolean);function X({data:o,selectedItems:c,onSelectionChange:e,onRowClick:r,pagination:n,loading:a,statusFilter:s,emptyStateDescription:d,managedColumns:g,onProcessRefund:f,onCancelRefund:w,onRetryRefund:p,onViewPayment:_,onViewCustomer:t,onAddNote:y,onFlag:R,onCopyId:C,activeItemId:h}){const i=u.useMemo(()=>g?j(Object.values(k),g):Y(s||"all"),[g,s]),T=u.useMemo(()=>o.filter(l=>["failed","canceled"].includes(l.status)).map(l=>l.id),[o]),U=u.useMemo(()=>q({onProcessRefund:f,onCancelRefund:w,onRetryRefund:p,onViewPayment:_,onViewCustomer:t,onAddNote:y,onFlag:R,onCopyId:C}),[f,w,p,_,t,y,R,C]);return x.jsx(V,{data:o,columns:i,selectedItems:c,onSelectionChange:e,getItemId:l=>l.id,onRowClick:r,rowActions:U,pagination:n,loading:a,unavailableItems:T,emptyStateDescription:d,className:"bg-background",getItemStatus:l=>l.status||"unknown",activeItemId:h})}function ee({statusFilter:o="all",filters:c={},currentPage:e=1,pageSize:r=20,sortBy:n="created",sortOrder:a="desc"}={}){const[s,d]=u.useState([]),[g,f]=u.useState(!0),[w,p]=u.useState(null),[_,t]=u.useState(0),[y,R]=u.useState({status:[]}),[C,h]=u.useState({status:[]}),i=u.useCallback(async l=>{try{f(!0),p(null);const S={pageSize:r,statusFilter:o==="all"?void 0:o,filters:c,sortBy:n,sortOrder:a},b=await D.getRefundsForNavigation(e,S);if(l?.aborted)return;d(b.data),t(b.total),b.facets&&(R(b.facets),h(b.facets))}catch(S){if(l?.aborted)return;const b=S instanceof Error?S.message:"Failed to fetch refunds";console.error("Error fetching refunds:",S),p(b),m.error(b),d([])}finally{l?.aborted||f(!1)}},[o,c,e,r,n,a]);u.useEffect(()=>{const l=new AbortController;return i(l.signal),()=>{l.abort()}},[i]);const T=i,U=u.useMemo(()=>Math.ceil(_/r),[_,r]);return{data:s,isLoading:g,error:w,totalItems:_,totalPages:U,facets:y,unfilteredFacets:C,refetch:i,retry:T}}const P=z(O),te=["all","pending","succeeded","failed","canceled"],ne=()=>B({statusCardValues:te,statusMappings:M.getMappings("refund"),sessionKeys:{statusFilter:"refund-status-filter",filters:"refunds-filters"},queryUtils:{parseQueryStringToFilters:P.parseQueryStringToFilters,buildQueryString:P.buildQueryString}});function se(){const o=A(),c=u.useCallback(async t=>{try{await D.processRefund(t.id),m.success(`Refund ${t.id} processed successfully!`)}catch{m.error(`Failed to process refund ${t.id}`)}},[]),e=u.useCallback(async t=>{try{await D.cancelRefund(t.id),m.success(`Refund ${t.id} canceled successfully!`)}catch{m.error(`Failed to cancel refund ${t.id}`)}},[]),r=u.useCallback(async t=>{try{await D.retryRefund(t.id),m.success(`Refund ${t.id} retry initiated!`)}catch{m.error(`Failed to retry refund ${t.id}`)}},[]),n=u.useCallback(t=>{o(`/refunds/${t.id}`)},[o]),a=u.useCallback(t=>{o(`/payments/${t.paymentId}`)},[o]),s=u.useCallback(t=>{m.info(`View customer for refund ${t.id}`)},[]),d=u.useCallback(t=>{m.info(`Add note for refund ${t.id}`)},[]),g=u.useCallback(t=>{m.success(`Refund ${t.id} flagged for review`)},[]),f=u.useCallback(async t=>{try{const y=t.map(R=>D.cancelRefund(R));await Promise.all(y),m.success(`${t.length} refunds canceled successfully`)}catch{m.error("Failed to cancel selected refunds")}},[]),w=u.useCallback(async t=>{try{(await D.exportRefunds(t)).success&&m.success(`Exporting ${t.length} refunds`)}catch{m.error("Failed to export selected refunds")}},[]),p=u.useCallback(()=>{o("/refunds/create")},[o]),_=u.useCallback(t=>{Q(t.id,"Refund")},[]);return{handleProcessRefund:c,handleCancelRefund:e,handleRetryRefund:r,handleViewRefund:n,handleViewPayment:a,handleViewCustomer:s,handleAddNote:d,handleFlag:g,handleBatchCancel:f,handleBatchExport:w,navigateToCreateRefund:p,copyRefundId:_}}function ue(){const[o,c]=u.useState(1),[e,r]=u.useState([]),n=W(),a=ne(),s=se();u.useEffect(()=>{c(1)},[a.statusFilter,a.query,a.tableFilters]);const d=ee({pageSize:n.pageSize,currentPage:o,statusFilter:a.statusFilter,filters:a.tableFilters}),g=p=>{s.handleBatchCancel(p),r([])},f=p=>{s.handleBatchExport(p),r([])},w={header:{title:"Refunds",description:"Process and track customer refunds",primaryAction:{label:"Create Refund",icon:x.jsx(H,{className:"h-4 w-4"}),onClick:s.navigateToCreateRefund}},statusFilters:M.getFilters("refund"),table:{component:X,props:{onProcessRefund:s.handleProcessRefund,onCancelRefund:s.handleCancelRefund,onRetryRefund:s.handleRetryRefund,onViewPayment:s.handleViewPayment,onViewCustomer:s.handleViewCustomer,onAddNote:s.handleAddNote,onFlag:s.handleFlag,onCopyId:s.copyRefundId,onRowClick:s.handleViewRefund}},tableFilters:{component:J,props:{entity:"refunds"}}};return x.jsx(G,{...w,useData:()=>({data:d.data,isLoading:d.isLoading,totalItems:d.totalItems,totalPages:d.totalPages,pagination:{currentPage:o,pageSize:n.pageSize,totalItems:d.totalItems,totalPages:d.totalPages,onPageChange:c},facets:d.facets}),useFilters:()=>a,useSelection:()=>({selectedItems:e,setSelectedItems:r,hasSelectedItems:e.length>0,handleClearSelection:()=>r([]),batchActionHandlers:{cancel:g,export:f}}),usePageSize:()=>n,animationKey:a.statusFilter})}export{ue as RefundsListPage,se as useRefundActions,ne as useRefundFilters,ee as useRefunds};
